# 浅谈互联网架构演变

****

## 前言

****

可以将某个项目或产品的架构体系按照如下方式分层：

- 业务层面：项目业务体系
- 技术层面：
  - 数据架构：数据持久层策略
  - 应用架构：应用层的实现方式
- 部署架构：部署方式，自动化持续集成等策略

针对每一层也随着时间的变化而变化。

****

## 业务架构

****

### 单体模式

****

早期的互联网产品多为单体系统，特点是以业务为导向，往往形成业务团队各自为战，在新业务线出现时需求大量增长。

这里补充部分业务模式的概念：

- B2B：企业与企业之间的供销模式
- B2C：企业面向消费者的交易模式
- C2C：消费者与消费者之间的交易模式
- O2O：线上与线下业务混合模式

随着公司的业务发展，业务层面会不断向 B2B、B2C 等扩张。

这就引出了单体架构的局限性：

- 功能冗余：B2B、B2C 会有相同的业务重叠，导致多个单体系统功能近似或冗余
- 数据不互通：多个跨域业务下，对于同一用户群体的数据不能互相沟通

功能冗余会带来成本的浪费（开发运维成本），数据的不互通带来业务壁垒，跨域业务间数据难以打通。

****

### 中台战略

****

为了解决单体架构带来的问题，阿里在 2015 年提出了中台战略，这是一种企业架构，而不是单纯的技术层面。

这里再细化一下单体系统相较中台战略的局限性：

- 技术和业务架构上：
  - 单体系统功能重复，而抽调出中台可以大幅减少冗余代码的开发
  - 业务集成度高，开发和运维成本高，而中台模式下，基础业务也下沉到技术部门，甚至通过技术反推业务发展
  - 对于多变的需求，中台战略可以将业务细化分层，上层业务针对产品快速迭代，下层业务持续沉淀，为上层业务封装底层接口
- 组织架构上：
  - 单体架构下，往往是每个项目就是一个团队，团队随项目扩张不断增大或重组复用，利用率低
  - 中台模式下，可以将上层业务和下层业务的团队分离，并将各个中台单独立项，提高利用率

除此之外，中台战略在业务扩展方面具备先天性优势：

![image-20231226002455240](https://image.itbaima.net/images/40/image-20231226003097740.png)



****

### 去中台化

****

虽然中台战略看起来已经足够优秀，但目前又呈现出了去中台化的趋势。

在大市场不断跟风的情况下，中台战略暴露出来的问题也越来越多：

- 中台战略需要过硬的技术支撑，大部分的公司没有完善的中台构建方案
- 公司业务差距太大，中台复用度不高，中台带来的生产价值远远小于中台的开发和运维成本
- 高度依赖中台的业务体系之间，耦合度严重提高

甚至中台战略的鼻祖——阿里的中台战略发展也没有达到预期，在反垄断的大背景下，减少大而集中的部门，拆分不同业务线独立发展，降低耦合。

****

## 数据架构

****

### 单体模式

****

早期的单体项目业务简单，一般只需要单体数据库（多为 MySQL），但随着业务体量不断增大，这一时期往往引发追逐商业大型数据库（Oracle）。

单体数据库架构多见于早期的 JavaWeb 和 SSH 项目：

- 通过 JDBC 直连，简单直接
- 数据库用 MySQL，或大型商业 DB
- 单库上的机器 IO 及 cpu 性能很快达到上限

****

### 主从读写

****

淘宝以前就是 MySQL，后来更换为了 Oracle，直到 2007 年又从 Oracle 回迁为了 MySQL，这个历程中实现了主从库的部署与读写分离。

这一架构的特点如下：

- 应用层连接多个数据库，数据库之间形成主从关系，主库为写，从库上读，分离读写压力
- 数据库集群策略，一主多从或双主单写，提升数据层的容灾和高可用能力

但是这一架构也避免不了带来新的问题：

- 数据不一致：主库到从库之间数据要进行同步，不同的数据同步策略会产生对应的问题
- 单库瓶颈：业务越来越多，表数量越来越多，甚至可能会出现单个库几百张表的现象
- 数据局限：依然无法解决单表大数据的问题

****

### 分库分表

****

为了解决单库的数据局限性问题，又引入了分库分表的解决方案：

- 水平分库：将一个库的数据拆分到多个库中
- 水平分表：将一张表的数据拆分到多个表中
- 垂直分表：将一张表的多个字段拆分到多个表中、

对于垂直分库，一般是分布式架构下，按照业务将数据库进行拆分，保存不同的表和数据。

对于分库分表也会不可避免地带来新的问题：

- 分库：不同的数据库，所以无法使用数据库事务，
- 而分布式事务的效果并不理想，多采用幂等和最终一致性方案
- 分表：拆了再聚合是一对矛盾，例如按下单时间维度的分表，需要按用户排序统计变得异常困难

****

### 高速缓存

****

数据库往往是系统的瓶颈，即便通过垂直分表可以将冷热数据进行分离，但从本质上仍然无法提升 IO 瓶颈。

因此，又提出根据数据的冷热划分，热点数据如类目、商品基础信息放在告诉缓存中，再其他数据延迟加载方案：

- redis：性能可靠，纯内存，自带分片，集群，哨兵，支持持久化，几乎成为当前的标准方案
- memcache：性能可靠，纯内存，客户端需要自己实现，无持久化
- ehcache：非分布式，简单，易维护，可用性一般

引入缓存，在实际生产中也会遇到问题：

- 缓存击穿：单一 Key 失效，遇到大量请求压垮数据库
- 缓存雪崩：大量 Key 失效，遇到大量请求压垮数据库
- 缓存穿透：不存在的 Key，遇到大量请求压垮数据库
- 数据不一致问题：数据库更新，缓存也要更新保持一致性

****

### 数据多样化

****

数据库和缓存只是一种基本的存储手段，除了这些，其他各种形式的存储结构和存储需求也相继涌现：

- NoSQL：非关系型数据库，如：Redis，MongoDB，Neo4j
- 分布式文件存储：存储不同文件，如：Hdfs，Fastdfs，CephFs，MinIO
- 搜索引擎：解决海量数据搜索问题，如：Lucene，Elasticsearch

针对这些需求，带来的架构层面的挑战也是巨大的：

- 数据可靠：面对高并发等场景，要保证数据服务的高可用
- 数据运维：多数据服务下，对应系统的容灾措施也相应复杂，维护成本水涨船高
- 数据安全：要求能够针对不同数据的访问权限进行隔离

****

## 应用架构

****

### 单机调优

****







